<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/base :: layout(~{::content})}">

<div th:fragment="content">

    <div>

        <h2 class="text-2xl font-semibold text-primary mb-6">
            Reset Your Password
        </h2>

        <p class="mb-4 text-gray-600">
            Enter your email and we will send you a password reset link.
        </p>

        <!-- Success -->
        <div id="successBox"
             class="hidden mb-4 p-3 bg-green-100 text-green-700 border border-green-300 rounded-md"></div>

        <!-- Error -->
        <div id="errorBox"
             class="hidden mb-4 p-3 bg-red-100 text-red-700 border border-red-300 rounded-md"></div>

        <form id="passwordRequestForm" class="space-y-5">

            <div>
                <label class="font-medium">Email</label>
                <input type="email" id="email" required
                       class="w-full mt-1 p-3 border rounded-lg focus:ring-primary focus:border-primary">
            </div>

            <button type="submit"
                    class="w-full bg-primary text-white py-3 rounded-lg hover:bg-indigo-700">
                Send Reset Link
            </button>

            <p class="mt-2">
                <a href="/login" class="text-primary hover:underline">Back to Login</a>
            </p>

        </form>

    </div>

<script>
document.getElementById("passwordRequestForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value;

    const successBox = document.getElementById("successBox");
    const errorBox = document.getElementById("errorBox");

    try {
        const response = await fetch("http://localhost:8080/api/auth/forgot-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email })
        });

        const message = await response.text();

        if (!response.ok) {
            throw new Error(message);
        }

        successBox.textContent = "If this email exists, a reset link has been sent.";
        successBox.classList.remove("hidden");
        errorBox.classList.add("hidden");

    } catch (err) {
        errorBox.textContent = err.message;
        errorBox.classList.remove("hidden");
        successBox.classList.add("hidden");
    }
});
</script>

</html>
